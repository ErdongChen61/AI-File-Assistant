<!DOCTYPE html>
<html>
    <head>
        <title>AI File Assistant</title>
    </head>
    <body>
        <h1>Register Directory</h1>
        <input id="registerInput" type="text" />
        <button onClick="registerDirectory()">Register</button>

        <h1>Unregister Directory</h1>
        <input id="unregisterInput" type="text" />
        <button onClick="unregisterDirectory()">Unregister</button>

        <h1>Query PDFs</h1>
        <input id="pdfQueryInput" type="text" />
        <button onClick="queryPDFs()">Search PDFs</button>

        <h1>Query Images</h1>
        <input id="imageQueryInput" type="text" />
        <button onClick="queryImages()">Search Images</button>

        <h1>Query Results</h1>
        <ul id="queryResults">
        </ul>

        <h1>Registered Directories</h1>
        <ul id="dirList">
            {% for dir in dirs %}
            <li>{{ dir }}</li>
            {% endfor %}
        </ul>

        <script>
            async function registerDirectory() {
                const dir = document.getElementById('registerInput').value;
                const response = await fetch('/register', {
                    method: 'POST',
                    headers: {
                        'Content-Type': 'application/json'
                    },
                    body: JSON.stringify({ dir: dir })
                });
                const data = await response.json();
                updateDirList(data.registered_directories);
            }

            async function unregisterDirectory() {
                const dir = document.getElementById('unregisterInput').value;
                const response = await fetch('/unregister', {
                    method: 'POST',
                    headers: {
                        'Content-Type': 'application/json'
                    },
                    body: JSON.stringify({ dir: dir })
                });
                const data = await response.json();
                updateDirList(data.registered_directories);
            }

            async function queryPDFs() {
                const query = document.getElementById('pdfQueryInput').value;
                const response = await fetch('/query_pdfs', {
                    method: 'POST',
                    headers: {
                        'Content-Type': 'application/json'
                    },
                    body: JSON.stringify({ query: query })
                });
                const data = await response.json();
                updateQueryResults(data);
            }

            async function queryImages() {
                const query = document.getElementById('imageQueryInput').value;
                const response = await fetch('/query_images', {
                    method: 'POST',
                    headers: {
                        'Content-Type': 'application/json'
                    },
                    body: JSON.stringify({ query: query })
                });
                const data = await response.json();
                updateQueryResults(data);
            }

            function updateQueryResults(results) {
                const queryResults = document.getElementById('queryResults');
                queryResults.innerHTML = '';
                for (const result of results) {
                    const li = document.createElement('li');
                    console.log('Result without valid metadata: ', result['metadata']);
                    li.textContent = result['metadata']['source'];
                    queryResults.appendChild(li);
                }
            }

            function updateDirList(dirs) {
                const dirList = document.getElementById('dirList');
                dirList.innerHTML = '';
                for (const dir of dirs) {
                    const li = document.createElement('li');
                    li.textContent = dir;
                    dirList.appendChild(li);
                }
            }
        </script>
</body>
</html>